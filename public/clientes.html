<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard de Llamadas</title>
  <link rel="stylesheet" href="/style.css"/>
  <!-- XLSX para importar/exportar Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>ðŸ“ž Dashboard de Llamadas</h1>
    <div class="userbar">
      <span>Bienvenido, <strong id="nombreUsuario">-</strong></span>
      <button class="button-danger" onclick="cerrarSesion()">ðŸ”’ Cerrar SesiÃ³n</button>
    </div>
  </header>

  <main class="container">
    <!-- ==== Panel Superadmin: seleccionar / crear empresa ==== -->
    <section id="seccionEmpresas" class="admin-section-card hidden" style="margin-bottom:16px;">
      <h2>Empresas</h2>
      <div class="form-row">
        <select id="empresaActivaSelect">
          <option value="">-- Selecciona empresa --</option>
        </select>
        <button id="btnEntrarEmpresa" class="button-primary">Entrar</button>
        <button id="btnSalirEmpresa" class="button-secondary">Salir</button>
      </div>
      <p id="empresaActivaMsg" class="info"></p>

      <hr style="margin:12px 0;">

      <h3>Crear nueva empresa</h3>
      <div class="form-row">
        <input id="nuevaEmpresaNombre" type="text" placeholder="Nombre de la empresa" />
        <input id="nuevaEmpresaAdmin" type="text" placeholder="Usuario admin (de la empresa)" />
        <input id="nuevaEmpresaPass" type="password" placeholder="ContraseÃ±a admin" />
        <button id="btnCrearEmpresa" class="button-success">âž• Crear Empresa</button>
      </div>
      <p id="empresaCreateMsg" class="info"></p>
    </section>

    <!-- ==== Bandeja del Gestor ==== -->
    <section class="card">
      <h2>Mis Clientes Asignados</h2>
      <div class="scroll">
        <table id="tablaClientes">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>TelÃ©fono</th>
              <th>DirecciÃ³n</th>
              <th>Tarifa</th>
              <th>Saldo Exigible</th>
              <th>Saldo</th>
              <th>Monto Cobrado</th>
              <th>Resultado</th>
              <th>Observaciones</th>
              <th>AcciÃ³n</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ==== Panel de AdministraciÃ³n ==== -->
    <section id="seccionAdmin" class="admin-section-card hidden">
      <h2>Panel de AdministraciÃ³n</h2>

      <!-- Subir clientes -->
      <div class="card">
        <h3>ðŸ“¥ Subir Clientes desde Excel</h3>
        <input type="file" id="archivoExcel" accept=".xlsx,.xls" onchange="procesarArchivo(event)"/>
        <p id="mensajeExcel" class="info"></p>
        <div style="margin-top:8px;">
          <button class="button-danger" onclick="limpiarClientes()">ðŸ§¹ Limpiar Todos los Clientes</button>
        </div>
      </div>

      <!-- GestiÃ³n de Usuarios -->
      <div class="card">
        <h3>ðŸ‘¥ Gestionar Usuarios</h3>
        <div class="form-row">
          <input type="text" id="nuevoUsuarioNombre" placeholder="Nombre de usuario"/>
          <input type="password" id="nuevoUsuarioPassword" placeholder="ContraseÃ±a"/>
          <button class="button-success" onclick="agregarUsuario()">âž• Agregar Usuario</button>
        </div>
        <div class="scroll">
          <table id="tablaUsuarios">
            <thead><tr><th>ID</th><th>Nombre</th><th>AcciÃ³n</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- AsignaciÃ³n de Clientes -->
      <div id="seccionAsignacion" class="card">
        <h3>ðŸ“Œ AsignaciÃ³n de Clientes</h3>
        <div class="form-row">
          <input type="text" id="filtroCliente" placeholder="Buscar cliente..." oninput="filtrarClientes()"/>
          <div class="right">
            <button id="btnGuardarUnoAUno" class="button-primary" onclick="guardarAsignaciones()">ðŸ’¾ Guardar (1 x 1)</button>
          </div>
        </div>

        <!-- Controles masivos -->
        <div class="form-row">
          <select id="massAssignUserSelect"><option value="">-- Seleccionar usuario --</option></select>
          <button id="massAssignBtn" class="button-purple">ðŸš€ Asignar Clientes Seleccionados</button>
        </div>
        <p id="massAssignMessage" class="info"></p>

        <div class="scroll">
          <table id="tablaAsignarClientes">
            <thead>
              <tr>
                <th><input type="checkbox" onclick="toggleAllClients(this)"/></th>
                <th>Cliente</th>
                <th>TelÃ©fono</th>
                <th>DirecciÃ³n</th>
                <th>Tarifa</th>
                <th>Saldo Exigible</th>
                <th>Saldo</th>
                <th>Usuario Asignado</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Reporte -->
      <div class="card">
        <h3>ðŸ“Š Reporte de Gestiones</h3>
        <div class="form-row">
          <label>Desde: <input type="date" id="repDesde"></label>
          <label>Hasta: <input type="date" id="repHasta"></label>
          <button id="btnCargarReporte" class="button-secondary">ðŸ”„ Mostrar</button>
          <button id="btnExportarReporte" class="button-success">ðŸ“„ Exportar Excel</button>
        </div>
        <p id="reporteMsg" class="info"></p>
        <div class="scroll" style="max-height:420px;">
          <table id="tablaReporte">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Cliente</th>
                <th>Resultado</th>
                <th>Monto Cobrado</th>
                <th>Fecha</th>
                <th>Observaciones</th>
                <th>Tarifa</th>
                <th>Saldo Exigible</th>
                <th>Saldo</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </section>
  </main>

  <div id="floatingMessage" class="toast hidden"></div>
  <script src="/script.js"></script>
</body>
</html>
